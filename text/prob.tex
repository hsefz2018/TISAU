\documentclass[UTF8, 11pt, a4paper]{article}
\usepackage[cm]{sfmath}
\usepackage{tabularx}
\def\arraystretch{1.3}
\usepackage[a4paper, top=3.18cm,bottom=3.81cm,left=2.54cm,right=2.54cm]{geometry}
\usepackage{indentfirst}
\setlength{\parskip}{6pt}
\XeTeXlinebreaklocale "zh"
\usepackage{graphicx}
\usepackage[normalem]{ulem}

\usepackage{fontspec}
\setmainfont{思源黑体}
\SetSymbolFont{largesymbols}{normal}{OMX}{iwona}{m}{n}
\setmonofont{Source Code Pro}

\begin{document}

\title{HSEFZ Practice Contest}
\maketitle

* 时间：3 小时
\newpage

\section*{Technology Intelligence See All Unbounded}

世界并非如你所见。

每一个存在着文明的角落，都散布着一种神秘的、未曾知晓的能量——研究者们称之为“异域能量”%
（Exotic Matter，缩写为 XM）。而人类的文明，也或多或少地在 XM 的影响下，在历史的长河中%
书写着属于它的篇章。

欧洲核子研究委员会（CERN）的科学家们聚到一起，成立了一个名为 Niantic Project 的项目，%
专门进行 XM 相关的研究。种种证据表明，XM 的背后存在着某种不可名状的强大力量……%
但关于它到底会给人类文明带来什么，没有人敢妄下论断。

科学家们最终找到了一种将智能手机转变成为“XM 扫描器”的方法……当这个实验室中的程序被%
匿名者伪装、改名为“Ingress”并公之于众，大量用户和 XM 发生了接触，成为了这场实验的参与者。%
人类内部反对和支持公开 XM 的分歧日益加剧，最终形成抵抗者（Resistance）和启蒙者（Enlightened）%
两个阵营，两方观点的拥护者成为了为各自阵营奋斗的特工……

XM 究竟会将人类引向何方？毁灭、启蒙，抑或是重生？

无论选择接受还是抵抗，都是时候行动了。
\newline\newline

\subsection*{题目概况}
\begin{tabularx}{\textwidth}{|X|X|X|X|}
\hline
题目名称 & A & B & C \\ \hline
文件名 & anomalies.* & portals.* & links.* \\ \hline
每个测试点时限 & 1 秒 & 1.5 秒 & 1 秒 \\ \hline
测试点数目 & 20 & 20 & 50 \\ \hline
每个测试点分值 & 5 & 5 & 2 \\ \hline
运行内存上限 & 256 MB & 256 MB & 256 MB \\ \hline
结果比较方式 & \multicolumn{3}{c|}{全文比较（过滤行末空格及文末回车）} \\ \hline
\end{tabularx}

* 除特殊说明外，输入、输出文件的数字之间均以恰一个空格分隔，行末字符为
Line Feed（\texttt{'\textbackslash n'}，ASCII 10），且该字符也存在于输入文件的最后一行末尾。

\subsection*{编译命令（以第一题为例）}
\begin{tabularx}{\textwidth}{|X|c|c|c|}
\hline
C & \multicolumn{3}{l|}{\texttt{gcc -o anomalies anomalies.c -lm}\makebox[5em]{}} \\ \hline
C++ & \multicolumn{3}{l|}{\texttt{g++ -o anomalies anomalies.cpp -lm}\makebox[5em]{}} \\ \hline
Pascal & \multicolumn{3}{l|}{\texttt{fpc anomalies.pas}\makebox[5em]{}} \\ \hline
\end{tabularx}
\newpage

% ========== Problem A ==========

\section*{A. \makebox[1em]{} Anomalies \makebox[2.5em]{} \small{「anomalies.c/cpp/pas」}}
在世界平静的外表下，XM 依旧以它不可知晓的规律运动着。%
全球各地的大城市由于人口密集，往往能吸引大量 XM，而如此数量的 XM 不时会突然出现%
无规律的猛烈扰动——人们称之为“XM 异常”。

令研究者们费解的是，每次 XM 异常都恰好发生在互不相同的三个城市。%
异常的发生时常伴随着一些东西吸引着每一位心怀大志的特工——丢失的数据、黑曜石之盾的碎片……%
因此，两个阵营总会在异常到来之时展开激烈的争夺。

Pisces 居住在一个名为新加坡的城市。根据 Niantic Project 的预测，%
新加坡即将迎来发生在这里的又一次异常，伴随着恢复人工智能 ADA 的数据和能量。%
为了在异常中作出更多的贡献，Pisces 收集了过去所有异常发生的地点并进行了分析。

每一座城市都有一个独一无二的编号，其中新加坡的编号为 $1$。当一次异常在三个城市发生，%
证明这三个城市存在着或多或少的未知联系（当然 Pisces 只需要关注其他城市与新加坡的联系）。%
Pisces 用“相关度”值来衡量联系的强度。这个值由以下规则确定：
\begin{itemize}
    \item 新加坡的相关度为 $0$；
    \item 如果一座城市和另一座相关度为 $x$ 的城市同时发生过一次异常，%
        那么这座城市的相关度不会大于 $x + 1$；
    \item 一座城市的相关度是所有可能取值中的最大值（这个值可以为无穷大）。
\end{itemize}

\subsection*{任务}
给定 $N$ 次异常的发生地点，计算每座城市和新加坡的相关度值。

\subsection*{输入 \makebox[0.5em]{} \small{「anomalies.in」}}
\begin{itemize}
    \item 第 $1$ 行：一个正整数，XM 异常的发生次数 $N$。
    \item 第 $2 \sim N+1$ 行：第 $i+1$ 行包含三个互不相同的正整数，%
        发生第 $i$ 次异常的三个城市的编号 $G_{i,1}, G_{i,2}, G_{i,3}$。
\end{itemize}

\subsection*{输出 \makebox[0.5em]{} \small{「anomalies.out」}}
\begin{itemize}
    \item 第 $1$ 行起：%
        在所有发生过异常的城市中，按\uwave{编号从小到大}的顺序，%
        每座城市占一行，包含两个正整数，依次为城市的编号和城市的相关度。%
        如果相关度为无穷大，输出 $-1$。
\end{itemize}
\newpage

\subsection*{样例}
\subsubsection*{样例一}
\begin{table}[h]\centering
\begin{tabularx}{0.8 \textwidth}{|X|X|}
\hline
\texttt{\textbf{anomalies1.in}} & \texttt{\textbf{anomalies1.out}} \\ \hline
{\ttfamily
7\newline
1 2 3\newline
4 2 5\newline
4 6 5\newline
7 1 2\newline
8 7 9\newline
10 8 11\newline
12 13 14
} & {\ttfamily
1 0\newline
2 1\newline
3 1\newline
4 2\newline
5 2\newline
6 3\newline
7 1\newline
8 2\newline
9 2\newline
10 3\newline
11 3\newline
12 -1\newline
13 -1\newline
14 -1
}
\\ \hline
\end{tabularx}\end{table}

\subsubsection*{样例二}
见附件中给出的 \texttt{\textbf{anomalies2.in}} 和 \texttt{\textbf{anomalies2.out}}。

\subsection*{数据规模与约定}
对于所有测试点，有 $N \geq 1, G_{1, 1} = 1$。

\begin{table}[h]\centering
\begin{tabularx}{0.85 \textwidth}{X|X|X|X} \hline
测试点编号 & $N$             & $\max{G_{i,j}}$ & 附加条件 \\ \hline\hline
1 - 3      & $\leq 10$       & $\leq 50$       & - \\ \hline
4 - 8      & $\leq 1\,000$   & $\leq 3\,000$   & - \\ \hline
9 - 14     & $\leq 150\,000$ & $\leq 450\,000$ & - \\ \hline
15         & $= 150\,000$    & $= 450\,000$    & $G_{i,j}$ 互不相同 \\ \hline
16 - 20    & $\leq 150\,000$ & $\leq 10^9$     & - \\ \hline
\end{tabularx}
\end{table}
\newpage

% ========== Problem B ==========

\section*{B. \makebox[1em]{} Portals \makebox[2.5em]{} \small{「portals.c/cpp/pas」}}
地球上有不少 XM 大量产出的地方，这些地方大都有名胜古迹、雕塑、喷泉或邮局——它们被称为“门泉”。

经过多年的努力，Libra 终于悟出了产生门泉的真谛——放置雕塑！%
Libra 计划在街区内放置一些雕塑并使之成为门泉，来让他和友军收集到更多的 XM。

街区被分成了 $N$ 行 $M$ 列的方格，每个格子内可以是以下三种之一：
\begin{itemize}
    \item \texttt{"\textbf{*}"}：空地，可以放置雕塑；
    \item \texttt{"\textbf{X}"}：障碍物，不可以放置雕塑；
    \item \texttt{"\textbf{O}"}：一位友军的住所，不可以放置雕塑；
\end{itemize}

每个雕塑都可以成为一个门泉，门泉能在地图上曼哈顿距离不超过 $R$ 的所有格子内产生%
一个单位的 XM。每位友军可以收集其住所所在格子的全部 XM。然而毕竟雕塑是有限的，%
Libra 希望在放置不超过 $T$ 个雕塑的前提下，使友军收集到尽可能多的 XM。

第 $r_1$ 行、第 $c_1$ 列的格子与 $r_2$ 行、第 $c_2$ 列格子的曼哈顿距离为%
$|r_1 - c_1| + |r_2 - c_2|$。

\subsection*{任务}
给定一个街区的地图，计算 Libra 用不超过 $T$ 个雕塑最多能使友军收集到多少单位的 XM。

\subsection*{输入 \makebox[0.5em]{} \small{「portals.in」}}
输入的第一行包含一个整数 $C^*$ 表示该测试点包含的数据组数。%
不同组数据互相独立，两组数据间不包含多余的空行。

每组数据的输入如下：
\begin{itemize}
    \item 第 $1$ 行：四个正整数，依次为：街区的行列数 $N$、$M$；
        Libra 拥有的雕塑数量 $T$；门泉产生 XM 的范围 $R$。
    \item 第 $2 \sim N+1$ 行：每行 $M$ 个字符，描述整个街区 $N$ 行 $M$ 列的地图。
\end{itemize}

\subsection*{输出 \makebox[0.5em]{} \small{「portals.out」}}
\begin{itemize}
    \item 第 $1 \sim C^*$ 行：%
        第 $i$ 行包含一个正整数，表示第 $i$ 组数据中友军能收集到 XM 的最多单位数。
\end{itemize}
\newpage

\subsection*{样例}
\subsubsection*{样例一}
\begin{table}[h]\centering
\begin{tabularx}{0.8 \textwidth}{|X|X|}
\hline
\texttt{\textbf{portals1.in}} & \texttt{\textbf{portals1.out}} \\ \hline
{\ttfamily
2\newline
3 3 2 1\newline
*O*\newline
OXO\newline
***\newline
4 5 3 2\newline
**O**\newline
*OXO*\newline
*****\newline
**O**
} & {\ttfamily
4\newline
7
}
\\ \hline
\end{tabularx}\end{table}

在第一组数据中，将两个雕塑放置于第 1 行第 1、3 列的格子可以为友军提供 4 单位的 XM。

在第二组数据中，将三个雕塑放置于第 3 行第 3 列和第 1 行第 2、4 列可以为友军提供 %
7 单位的 XM。也存在另外的方案可以提供同样数目的 XM。

\subsubsection*{样例二}
见附件中给出的 \texttt{\textbf{portals2.in}} 和 \texttt{\textbf{portals2.out}}。

\subsection*{数据规模与约定}
对于所有测试点，有 $C^* = 5$；对于所有数据有 $1 \leq N, M$，$1 \leq T, R \leq 10^8$，%
且至少存在一个空地格子。

\begin{table}[h]\centering
\begin{tabularx}{0.85 \textwidth}{X|X|X} \hline
测试点编号 & $N, M$     & 附加条件 \\ \hline\hline
1 - 3      & $= 4$      & $T = 16$ \\ \hline
4 - 6      & $= 5$      & $T = 5$ \\ \hline
7 - 10     & $\leq 50$  & - \\ \hline
11 - 14    & $\leq 500$ & $N = 1$ \\ \hline
15 - 16    & $\leq 500$ & $R = 1$ \\ \hline
17 - 20    & $\leq 500$ & - \\ \hline
\end{tabularx}
\end{table}
\newpage

% ========== Problem C ==========

\section*{C. \makebox[1em]{} Links \makebox[2.5em]{} \small{「links.c/cpp/pas」}}
每一位特工都可以在门泉之间建立连线。据说，每当连线形成一个三角形，%
它所包围的区域内便会形成一个控制场，其中人们的思想将会受到它的微小影响。

Capricornus 发现了一群排列成环形的门泉，计划着在它们之间建立连线。%
但是由于控制场有未知性和危险性，Capricornus 需要慎重考虑门泉之间连线的建立顺序，%
以及占领这些门泉的顺序。

将这些门泉按顺时针顺序依次编号为 $1, 2, \dots, N$，那么称 $i$ 号和 $i + 1$ 号门泉%
是相邻的，$N$ 号和 $1$ 号门泉是相邻的。Capricornus 需要按一定顺序占领其中的任意 $K$ 个门泉%
方能开始任务。一段（一个、多个或 $N$ 个）连续相邻的被占领门泉被 Capricornus 视作一个“团”（cluster）。

Capricornus 按照人生经验判断，在整个占领的过程的\uwave{任意时刻}，形成“团”的数量不能超过 $G$ 个，%
否则可能有导致连接线和控制场不稳定的风险。

正沉迷于规划中的 Capricornus 想知道，有多少种满足条件的占领 $K$ 个门泉的顺序。%
门泉是两两不同的，因此旋转后相同的方案不算作一种。

\subsection*{任务}
给定 $N$、$K$、$G$ 的值，计算满足条件的占领 $N$ 个门泉中 $K$ 个的方案数目除以 $10^9 + 7$ 的余数。

\subsection*{输入 \makebox[0.5em]{} \small{「links.in」}}
输入的第一行包含一个整数 $C^*$ 表示该测试点包含的数据组数。%
不同组数据互相独立，两组数据间不包含多余的空行。

每组数据的输入如下：
\begin{itemize}
    \item 第 $1$ 行：三个正整数，依次为：
        门泉的数量 $N$；需要占领的门泉数 $K$；“团”的上限数目 $G$。
\end{itemize}

\subsection*{输出 \makebox[0.5em]{} \small{「links.out」}}
\begin{itemize}
    \item 第 $1 \sim C^*$ 行：%
        第 $i$ 行包含一个正整数，表示第 $i$ 组数据中不同的方案数除以 $10^9 + 7$ 的余数。
\end{itemize}
\newpage

\subsection*{样例}
\subsubsection*{样例一}
\begin{table}[h]\centering
\begin{tabularx}{0.8 \textwidth}{|X|X|}
\hline
\texttt{\textbf{links1.in}} & \texttt{\textbf{links1.out}} \\ \hline
{\ttfamily
4\newline
4 2 1\newline
5 4 2\newline
6 4 4\newline
42 23 7
} & {\ttfamily
8\newline
120\newline
360\newline
917668006
}
\\ \hline
\end{tabularx}\end{table}

在第一组数据中，满足条件占领的顺序有 1-2，2-3，3-4，4-1，1-4，4-3，3-2，2-1 共 8 种。

在第三组数据中，以任意顺序占领任意 4 个门泉即符合要求，方案共 $6 \times 5 \times 4 \times 3 = 360$ 种。

\subsection*{数据规模与约定}
对于所有数据有 $1 \leq G \leq K \leq N$，$2 \leq N$。

\begin{table}[h]\centering
\begin{tabularx}{0.85 \textwidth}{X|X|X|X} \hline
测试点编号 & $C^*$ & $N$           & 附加条件 \\ \hline\hline
1 - 3      & $5$   & $\leq 8$      & $G = 1$ \\ \hline
4 - 8      & $5$   & $\leq 8$      & - \\ \hline
9 - 15     & $5$   & $\leq 20$     & - \\ \hline
16 - 20    & $5$   & $\leq 2\,000$ & $G \leq 20$ \\ \hline
21 - 23    & $5$   & $\leq 2\,500$ & - \\ \hline
24 - 25    & $10$  & $\leq 2\,500$ & - \\ \hline
\end{tabularx}
\end{table}

\end{document}

